{
  "$schema": "https://www.krakend.io/schema/v3.json",
  "version": 3,
  "name": "KrakenD API Gateway (DEVELOPMENT)",
  "port": 8080,
  "timeout": "3s",
  "cache_ttl":  "3s",
  "output_encoding": "json",
  "extra_config": {},
  "client_tls": {"allow_insecure_connections":true},
  "plugin": {"folder":"/etc/krakend/plugins","pattern":".so"},
  "endpoints": [
    {
   "endpoint": "/models",
   "method": "GET",
  "input_headers": [
        "Content-Type",
        "ClientId",
        "Authorization",
        "x-api-key"
      ],
   "backend": [
   {
     "url_pattern": "/api/models",
     "extra_config": {
       "qos/ratelimit/proxy": {
  "max_rate": 0.5,
  "capacity": 1
}

     },
     "host": ["http://host.docker.internal:8090/"]
   }
   ]
},
{
   "endpoint": "/models",
   "method": "POST",
  "input_headers": [
        "Content-Type",
        "ClientId",
        "Authorization",
        "x-api-key"
      ],
   "backend": [
   {
     "url_pattern": "/api/models",
     "extra_config": {
       "qos/ratelimit/proxy": {
  "max_rate": 0.5,
  "capacity": 1
}
,
        "plugin/http-client":{
	           "name":"bill-balance",
	           "bill-balance":{
	               "path": "/api/models"
	           }
	      }
     },
     "host": ["http://host.docker.internal:8090/"]
   }
   ]
},
{
   "endpoint": "/models/{model_id}",
   "method": "GET",
  "input_headers": [
        "Content-Type",
        "ClientId",
        "Authorization",
        "x-api-key"
      ],
   "backend": [
   {
     "url_pattern": "/api/models/{model_id}",
     "extra_config": {
       "qos/ratelimit/proxy": {
  "max_rate": 0.5,
  "capacity": 1
}

     },
     "host": ["http://host.docker.internal:8090/"]
   }
   ]
},
{
   "endpoint": "/models/{model_id}",
   "method": "DELETE",
  "input_headers": [
        "Content-Type",
        "ClientId",
        "Authorization",
        "x-api-key"
      ],
   "backend": [
   {
     "url_pattern": "/api/models/{model_id}",
     "extra_config": {
       "qos/ratelimit/proxy": {
  "max_rate": 0.5,
  "capacity": 1
}

     },
     "host": ["http://host.docker.internal:8090/"]
   }
   ]
},
{
   "endpoint": "/models/{model_id}",
   "method": "UPDATE",
  "input_headers": [
        "Content-Type",
        "ClientId",
        "Authorization",
        "x-api-key"
      ],
   "backend": [
   {
     "url_pattern": "/api/models/{model_id}",
     "extra_config": {
       "qos/ratelimit/proxy": {
  "max_rate": 0.5,
  "capacity": 1
}

     },
     "host": ["http://host.docker.internal:8090/"]
   }
   ]
},
{
   "endpoint": "/datasets",
   "method": "GET",
  "input_headers": [
        "Content-Type",
        "ClientId",
        "Authorization",
        "x-api-key"
      ],
   "backend": [
   {
     "url_pattern": "/api/datasets",
     "extra_config": {
       "qos/ratelimit/proxy": {
  "max_rate": 0.5,
  "capacity": 1
}

     },
     "host": ["http://host.docker.internal:8090/"]
   }
   ]
},
{
    "endpoint": "/datasets",
    "method": "POST",
  "input_headers": [
        "Content-Type",
        "ClientId",
        "Authorization",
        "x-api-key"
      ],
  "backend": [
    {
        "url_pattern": "/api/datasets",
        "extra_config": {
        "qos/ratelimit/proxy": {
  "max_rate": 0.5,
  "capacity": 1
}
,
        "plugin/http-client":{
	           "name":"bill-balance",
	           "bill-balance":{
	               "path": "/api/datasets"
	           }
	        }
        },
        "host": ["http://host.docker.internal:8090/"]
    }
    ]
},
{
   "endpoint": "/datasets/{model_id}",
   "method": "GET",
  "input_headers": [
        "Content-Type",
        "ClientId",
        "Authorization",
        "x-api-key"
      ],
   "backend": [
   {
     "url_pattern": "/api/datasets/{model_id}",
     "extra_config": {
       "qos/ratelimit/proxy": {
  "max_rate": 0.5,
  "capacity": 1
}

     },
     "host": ["http://host.docker.internal:8090/"]
   }
   ]
},
{
   "endpoint": "/datasets/{model_id}",
   "method": "DELETE",
  "input_headers": [
        "Content-Type",
        "ClientId",
        "Authorization",
        "x-api-key"
      ],
   "backend": [
   {
     "url_pattern": "/api/datasets/{model_id}",
     "extra_config": {
       "qos/ratelimit/proxy": {
  "max_rate": 0.5,
  "capacity": 1
}

     },
     "host": ["http://host.docker.internal:8090/"]
   }
   ]
},
{
   "endpoint": "/datasets/{model_id}",
   "method": "UPDATE",
  "input_headers": [
        "Content-Type",
        "ClientId",
        "Authorization",
        "x-api-key"
      ],
   "backend": [
   {
     "url_pattern": "/api/datasets/{model_id}",
     "extra_config": {
       "qos/ratelimit/proxy": {
  "max_rate": 0.5,
  "capacity": 1
}

     },
     "host": ["http://host.docker.internal:8090/"]
   }
   ]
},
{
   "endpoint": "/billings/balance",
   "method": "POST",
  "input_headers": [
        "Content-Type",
        "ClientId",
        "Authorization",
        "x-api-key"
      ],
   "backend": [
   {
     "url_pattern": "/api/billings/balance",
     "extra_config": {
       "qos/ratelimit/proxy": {
  "max_rate": 0.5,
  "capacity": 1
}

     },
     "host": ["http://host.docker.internal:8090/"]
   }
   ]
},
{
   "endpoint": "/billings/check",
   "method": "POST",
  "input_headers": [
        "Content-Type",
        "ClientId",
        "Authorization",
        "x-api-key"
      ],
   "backend": [
   {
     "url_pattern": "/api/billings/check",
     "extra_config": {
       "qos/ratelimit/proxy": {
  "max_rate": 0.5,
  "capacity": 1
}

     },
     "host": ["http://host.docker.internal:8090/"]
   }
   ]
}

 ]
}
